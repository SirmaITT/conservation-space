<?xml version="1.0" encoding="UTF-8"?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml" xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core" xmlns:h="http://java.sun.com/jsf/html" xmlns:a4j="http://richfaces.org/a4j"
	xmlns:rich="http://richfaces.org/rich" xmlns:emf="http://com.sirma.itt.emf">

	<rich:list id="caseSectionList" value="#{sectionAction.sectionList}" var="currentSectionInstance"
		iterationStatusVar="counter" type="unordered" styleClass="standard-list sections-list"
		rowClass="context sectioninstance clearfix">

		<ui:param name="sectionContent" value="#{sectionAction.getSectionContentById(currentSectionInstance.id)}" />

		<div
			class="section-row #{currentSectionInstance.identifier} #{(currentSectionInstance.content.isEmpty()) ? '' : 'expanded'}">
			<div class="section-togler"></div>

			<emf:treeHeader currentInstance="#{currentSectionInstance}" mode="compact_header" display="current_only"
				size="medium" />

			<emf:panel styleClass="case-section-actions allowed-actions-inline">
				<ui:include src="/common/min-allowed-actions.xhtml">
					<ui:param name="currentInstance" value="#{currentSectionInstance}" />
					<ui:param name="contextInstance" value="#{documentContext.getCurrentInstance()}" />
					<ui:param name="placeholder" value="case-objects-list" />
					<ui:param name="renderLabel" value="true" />
				</ui:include>
			</emf:panel>

			<span class="group-search-toolbar">

				<span class="toolbar-counter">#{sectionContent.totalCount} #{sectionAction.counterLabel}</span>

				<ui:include src="/search/dashlet-search/search-toolbar.xhtml">
					<ui:param name="panelId" value="section-#{counter.index}" />
					<ui:param name="listId" value="#{rich:clientId('caseSectionList')}" />
					<ui:param name="action" value="#{sectionContent}" />
					<ui:param name="renderId" value="caseSectionList" />
					<ui:param name="disableBlockUI" value="true" />
					<ui:param name="renderFilters" value="false" />
				</ui:include>
			</span>

		</div>

		<rich:list id="sectionElementList" value="#{sectionContent.result}" var="elementInstance" type="unordered"
			styleClass="standard-list section-items-list" rowClass="child clearfix">

			<div class="data-column">
				<emf:treeHeader currentInstance="#{elementInstance}" mode="default_header" display="current_only" size="bigger"
					disableLinks="#{!entityPreviewAction.canOpenInstance(caseInstance)}">
					<ui:define name="beforeContent">
						<ui:include src="/common/banner.xhtml">
							<ui:param name="renderIf" value="#{elementInstance.isLocked()}" />
							<ui:param name="label" value="#{labelBuilder.getDocumentIsLockedMessage(elementInstance)}" />
							<ui:param name="bannerClass" value="info-banner" />
						</ui:include>
					</ui:define>
				</emf:treeHeader>
			</div>

			<div class="actions-column">
				<ui:include src="/common/min-allowed-actions.xhtml">
					<ui:param name="currentInstance" value="#{elementInstance}" />
					<ui:param name="contextInstance" value="#{currentSectionInstance}" />
					<ui:param name="placeholder" value="case-element-action" />
				</ui:include>
			</div>

		</rich:list>
	</rich:list>

	<a4j:commandLink id="sectionActivator" render="caseSectionList" action="#{sectionAction.extractSectionContent()}"
		styleClass="hidden selector-action" />

	<script type="text/javascript">
		$(function(){
			var sectionActivator = $(".selector-action");
			if(sectionActivator != undefined){
				sectionActivator.click();
			}
		});
	</script>
</ui:composition>
