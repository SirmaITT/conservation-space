<?xml version="1.0"?>
<definition id="template" parentId="GEO10001" isAbstract="false" type="object">
    <fields>
		<field name="default_header" type="ANY" label="TEMPLATE_DEFAULT_HEADER" mandatory="false" displayType="system" dmsType="FORBIDDEN" />
		<field name="tooltip_header" type="an..4096" label="TEMPLATE_TOOLTIP_HEADER" mandatory="false" displayType="system" dmsType="FORBIDDEN" />

		<field name="rdf:type" type="URI" label="type.label" displayType="system" uri="rdf:type" dmsType="FORBIDDEN">
            <value>http://ittruse.ittbg.com/ontology/enterpriseManagementFramework#Template</value>
        </field>
        <field name="type" type="an..50" codelist="CL7" label="type.label" mandatory="false" displayType="system" dmsType="emf:type" uri="emf:type">
            <value>TEMPLATE</value>
        </field>
		<field name="status" type="an..50" codelist="CL17" label="status.label" mandatory="false" displayType="readonly" previewEmpty="false" dmsType="emf:status" uri="emf:status" />
		<field name="forObjectType" type="an..256" label="template.forObjectType" mandatory="true" displayType="readonly" multiValued="false" dmsType="FORBIDDEN" uri="emf:forObjectType"/>
		<field name="templatePurpose" type="an..30" label="template.templatePurpose" mandatory="true" displayType="readonly" multiValued="false" dmsType="FORBIDDEN" uri="emf:templatePurpose"/>
		<field name="isPrimaryTemplate" type="boolean" label="template.isPrimaryTemplate" mandatory="false" displayType="readonly" multiValued="false" dmsType="FORBIDDEN" uri="emf:isPrimaryTemplate"/>
    	
    	<!-- Hide irrelevant object fields -->
    	<field name="outcome" type="an..50" displayType="system" />
		<field name="integrated" type="boolean" displayType="system" />
		<field name="uri" type="an..50" displayType="system" />
		<field name="completedOn" type="datetime" displayType="system" />
		<field name="hasRevision" type="uri" displayType="system" />
		<field name="isRevisionOf" type="uri" displayType="system" />
		<field name="lastPublishedRevision" type="uri" displayType="system" />
		<field name="lastRevision" type="uri" displayType="system" />
		<field name="nextRevision" type="uri" displayType="system" />
		<field name="previousRevision" type="uri" displayType="system" />
		
    </fields>
	<transitions>
		<transition id="activateTemplate" label="template.activate" tooltip="activateTemplate.tooltip" eventId="activateTemplate" purpose="activateTemplate"></transition>
	</transitions>
	<stateTransitions>		
		<stateTransition from="INIT" transition="create" to="DRAFT" />
		<stateTransition from="DRAFT" transition="activateTemplate" to="ACTIVE"/>
		<stateTransition from="ACTIVE" transition="editDetails" to="DRAFT"/>
		<stateTransition from="INACTIVE" transition="editDetails" to="DRAFT"/>

		<stateTransition from="DRAFT" transition="editDetails" to="DRAFT" />
		<stateTransition from="DRAFT" transition="delete" to="DELETED" />
		<stateTransition from="DRAFT" transition="lock" to="DRAFT"/>
		<stateTransition from="DRAFT" transition="unlock" to="DRAFT"/>			
		<stateTransition from="DRAFT" transition="managePermissions" to="DRAFT" />
		<stateTransition from="DRAFT" transition="addThumbnail" to="DRAFT" />
		<stateTransition from="DRAFT" transition="createInContext" to="DRAFT"/>

		<stateTransition from="ACTIVE" transition="editDetails" to="ACTIVE" />
		<stateTransition from="ACTIVE" transition="delete" to="DELETED" />
		<stateTransition from="ACTIVE" transition="lock" to="ACTIVE"/>
		<stateTransition from="ACTIVE" transition="unlock" to="ACTIVE"/>
		<stateTransition from="ACTIVE" transition="managePermissions" to="ACTIVE" />
		<stateTransition from="ACTIVE" transition="addThumbnail" to="ACTIVE" />
		<stateTransition from="ACTIVE" transition="createInContext" to="ACTIVE"/>
		
		<stateTransition from="INACTIVE" transition="editDetails" to="INACTIVE" />
		<stateTransition from="INACTIVE" transition="delete" to="DELETED" />
		<stateTransition from="INACTIVE" transition="lock" to="INACTIVE"/>
		<stateTransition from="INACTIVE" transition="unlock" to="INACTIVE"/>			
		<stateTransition from="INACTIVE" transition="managePermissions" to="INACTIVE" />
		<stateTransition from="INACTIVE" transition="addThumbnail" to="INACTIVE" />
		<stateTransition from="INACTIVE" transition="createInContext" to="INACTIVE"/>
    </stateTransitions>
	<labels>
		<label id="TEMPLATE_TOOLTIP_HEADER">
			<value lang="en"><![CDATA[${eval(#{eval(
				<span class="thumbnail-content">
					<img class="thumbnail" src="${thumbnailUri(64)}" />
				</span>
				<span class="tooltip-data">
					<span class="tooltip-header">
						<a href="${link(currentInstance)}" class="instance-link" data-status="${get([status])}" data-id="${id.db}" data-uid="${id.uid}">
							(<span data-type="${get([type])}">${CL([type])}</span>) 
							<span data-title="${get([title])}">${get([title])}</span>
						</a>
					</span>
					<span class="tooltip-row">
						<label>Title: </label>
						<span data-property="title">${get([title])}</span>
					</span>
					<span class="tooltip-row">
						<label>For object type: </label>
						<span data-property="forObjectType">${CL([forObjectType])}</span>
					</span>
					<span class="tooltip-row">
						<label>Primary: </label>
						<span data-property="isPrimaryTemplate">${get([isPrimaryTemplate])}</span>
					</span>
					<span class="tooltip-row">
						<label>Template purpose: </label>
						<span data-property="templatePurpose">${get([templatePurpose])}</span>
					</span>
					<span class="tooltip-row">
						<label>Template status:</label>
						<span data-property="status">${CL([status])}</span>
					</span>
					<span class="tooltip-row">
						<label>Created by:</label>
						<span data-property="createdBy">${user(${get([createdBy])})}</span>
					</span>
				</span>
			)})}]]></value>
			<value lang="bg"><![CDATA[${eval(#{eval(
				<span class="thumbnail-content">
					<img class="thumbnail" src="${thumbnailUri(64)}" />
				</span>
				<span class="tooltip-data">
					<span class="tooltip-header">
						<a href="${link(currentInstance)}" class="instance-link" data-status="${get([status])}" data-id="${id.db}" data-uid="${id.uid}">
							(<span data-type="${get([type])}">${CL([type])}</span>) 
							<span data-title="${get([title])}">${get([title])}</span>
						</a>
					</span>
					<span class="tooltip-row">
						<label>Заглавие:</label>
						<span data-property="title">${get([title])}</span>
					</span>
					<span class="tooltip-row">
						<label>За тип:</label>
						<span data-property="forObjectType">${CL([forObjectType])}</span>
					</span>
					<span class="tooltip-row">
						<label>Тип шаблон:</label>
						<span data-property="isPrimaryTemplate">Главен: ${get([isPrimaryTemplate])}</span>
					</span>
					<span class="tooltip-row">
						<label>Главен</label>
						<span data-property="templatePurpose">${get([templatePurpose])}</span>
					</span>
					<span class="tooltip-row">
						<label>Състояние:</label>
						<span data-property="status">${CL([status])}</span>
					</span>
					<span class="tooltip-row">
						<label>Създаден от:</label>
						<span data-property="createdBy">${user(${get([createdBy])})}</span>
					</span>
				</span>
			)})}]]></value>
		</label>
		<label id="TEMPLATE_DEFAULT_HEADER">
			<value lang="en"><![CDATA[${eval(
			${var.href= ${if(${get([emf:isDeleted])} == false).then(href="${link(currentInstance)}")} }
			${var.isLatest=${if((${get([emf:revisionType])}).matches(.*?latest)).then(true).else(false)}}
			${var.isRevision=${if((${get([emf:revisionType])}).matches(.*?revision)).then(true).else(false)}}
			${var.isVersion= ${if(${get([isVersion])} == true).then(true).else(false)}}
			<span ><img src="${thumbnailUri(64)}"/></span>
			<span>
				<span class="truncate-element${if(${var.isLatest}).then( latest-revision)}${if(${var.isRevision}).then( revision)}">
					<a ${var.href} class="instance-link ${if(${get([emf:isDeleted])} == true).then(instance-deleted).else(has-tooltip)}">
						${if(${get([emf:isDeleted])} == true).then(<span><b>(Deleted) </b></span>)}
						${if(${or(${var.isLatest} or ${var.isRevision})}).then(
						<b>
							(<span data-property="type">${CL([type])}</span>)&nbsp;
							<span data-property="title">${get([title])}</span>&nbsp;
							(<span data-property="status">${CL([status])}</span>)&nbsp;
						</b>
						).else(
						<b>
							(<span data-property="type">${CL([type])}</span>)&nbsp;
							<span data-property="title">${get([title])}</span>&nbsp;
							(<span data-property="status">${CL([status])}</span>)&nbsp;
						</b>
						)}
						<b>
						${if(${var.isVersion}).then(
							<span data-property="emf:version">${get([emf:version])}</span>
						)}
						</b>
					</a>
				</span>
				<br />Primary: <span data-property="isPrimaryTemplate">${get([isPrimaryTemplate])}</span> ,&nbsp;
				Purpose: <span data-property="templatePurpose">${get([templatePurpose])}</span>
				${if(${get([lockedBy])} <> null).then(<br /><span class="banner label label-warning">${label(lockedBy)}${user([lockedBy])}</span>)}
			</span>)}]]></value>
			<value lang="bg"><![CDATA[${eval(
			${var.href= ${if(${get([emf:isDeleted])} == false).then(href="${link(currentInstance)}")} }
			${var.isLatest=${if((${get([emf:revisionType])}).matches(.*?latest)).then(true).else(false)}}
			${var.isRevision=${if((${get([emf:revisionType])}).matches(.*?revision)).then(true).else(false)}}
			${var.isVersion= ${if(${get([isVersion])} == true).then(true).else(false)}}
			<span ><img src="${thumbnailUri(64)}"/></span>
			<span>
				<span class="truncate-element${if(${var.isLatest}).then( latest-revision)}${if(${var.isRevision}).then( revision)}">
					<a ${var.href} class="instance-link ${if(${get([emf:isDeleted])} == true).then(instance-deleted).else(has-tooltip)}">
						${if(${get([emf:isDeleted])} == true).then(<span><b>(Deleted) </b></span>)}
						${if(${or(${var.isLatest} or ${var.isRevision})}).then(
						<b>
							(<span data-property="type">${CL([type])}</span>)&nbsp;
							<span data-property="title">${get([title])}</span>&nbsp;
							(<span data-property="status">${CL([status])}</span>)&nbsp;
						</b>
						).else(
						<b>
							(<span data-property="type">${CL([type])}</span>)&nbsp;
							<span data-property="title">${get([title])}</span>&nbsp;
							(<span data-property="status">${CL([status])}</span>)&nbsp;
						</b>
						)}
						<b>
						${if(${var.isVersion}).then(
							<span data-property="emf:version">${get([emf:version])}</span>
						)}
						</b>
					</a>
				</span>
				<br />Главен: <span data-property="isPrimaryTemplate">${get([isPrimaryTemplate])}</span> ,&nbsp;
				Цел на шаблона: <span data-property="templatePurpose">${get([templatePurpose])}</span>
				${if(${get([lockedBy])} <> null).then(<br /><span class="banner label label-warning">${label(lockedBy)}${user([lockedBy])}</span>)}
			</span>)}]]></value>
		</label>
	</labels>
</definition>
