<?xml version="1.0" encoding="UTF-8"?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml" xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core" xmlns:h="http://java.sun.com/jsf/html" xmlns:a4j="http://richfaces.org/a4j"
	xmlns:rich="http://richfaces.org/rich">

	<ui:param name="toolbarId" value="#{panelId}-search-toolbar" />
	<ui:param name="filterWrapperId" value="#{panelId}-filter" />
	<ui:param name="sorterWrapperId" value="#{panelId}-sorter" />
	<ui:param name="changeOrderWrapperId" value="#{panelId}-order" />
	<ui:param name="filterMenuId" value="#{panelId}-filter-list" />
	<ui:param name="sorterMenuId" value="#{panelId}-sorter-list" />
	<ui:param name="renderBlockUI" value="#{(disableBlockUI != null) ? disableBlockUI : false}" />
	<ui:param name="renderFilter" value="#{(renderFilters != null) ? renderFilters : true}" />

	<h:panelGroup id="#{toolbarId}" layout="block" styleClass="#{toolbarId} search-toolbar">
		<div id="#{filterWrapperId}" class="tool filter-menu-tool">
			<h:selectOneMenu id="#{filterMenuId}" value="#{action.selectedFilter}" immediate="false" rendered="#{renderFilter}"
				styleClass="select-one-menu filter-menu default-#{action.isDefaultFilter(action.selectedFilter, action.defaultFilter)} #{styleClass}">
				<f:selectItems value="#{action.filters}" var="searchFilter" itemLabel="#{searchFilter.label}"
					itemValue="#{searchFilter.value}" />
			</h:selectOneMenu>
		</div>

		<div id="#{sorterWrapperId}" class="tool sorting-menu-tool">
			<h:selectOneMenu id="#{sorterMenuId}" value="#{action.selectedSorter}" immediate="false"
				styleClass="select-one-menu sorter-menu default-#{action.isDefaultFilter(action.selectedSorter, action.defaultSorter)}">
				<f:selectItems value="#{action.sorters}" var="searchSorter" itemLabel="#{searchSorter.label}"
					itemValue="#{searchSorter.value}" />
			</h:selectOneMenu>
		</div>

		<div id="#{changeOrderWrapperId}" class="tool change-order-tool">
			<a4j:commandLink id="#{panelId}-changeOrderButton" value="" action="#{action.changeOrder()}"
				render="#{renderId}, #{toolbarId}" execute="@this"
				onbegin="if(!#{renderBlockUI}){EMF.ajaxloader.showLoading($('[id$=#{panelId}]').find('.panel-body'));}"
				oncomplete="if(!#{renderBlockUI}){EMF.ajaxloader.hideLoading($('[id$=#{panelId}]').find('.panel-body'));} #{oncomplete}"
				title="#{label['cmf.search.toolbar.switch_order']}"
				styleClass="btn btn-default btn-sm glyphicon switch-order-btn #{(action.orderAscending) ? 'glyphicon-sort-by-alphabet' : 'glyphicon-sort-by-alphabet-alt'}">
				<h:outputText value=" " />
			</a4j:commandLink>
		</div>
		
		<h:commandLink id="#{panelId}-searchExecuteLink" action="#{action.searchCriteriaChanged()}" immediate="false" styleClass="hidden search-execute-link">
			<a4j:ajax execute="searchExecuteLink, #{listId}, #{filterMenuId}, #{sorterMenuId}" render="#{renderId}, #{toolbarId}"
				limitRender="true"
				onbegin="if(!#{renderBlockUI}){EMF.ajaxloader.showLoading($('[id$=#{panelId}]').find('.panel-body'));}"
				oncomplete="if(!#{renderBlockUI}){EMF.ajaxloader.hideLoading($('[id$=#{panelId}]').find('.panel-body'));} #{oncomplete}" />
		</h:commandLink>

		<script type="text/javascript">
			$(function() {
				var toolbar = $('.#{toolbarId}');
				$(toolbar.find('.select-one-menu')).select2({
					width: '150px',
					minimumResultsForSearch: 10,
					allowClear: true,
					formatResultCssClass: function(object) {
						return object.id;
					}
				}).on('change', function(evt, params) {
					var actionLink = $(this).closest('.search-toolbar').find('.search-execute-link');
					actionLink.click();
				}).on('select2-highlight', function() {
					
				});
			});
		</script>
	</h:panelGroup>

</ui:composition>
